<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flicker Effect</title>
    <style>
        /* Reset styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Body styling */
        body {
            background-color: #111;
            overflow: hidden; /* Prevents scrolling */
            font-family: 'Arial', sans-serif;
        }

        /* Full-screen container for flickering effect */
        .flicker-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            opacity: 1; /* Initial opacity */
            transition: opacity 0.1s ease-in-out;
        }

        /* Centered button */
        .button-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
        }

        button {
            background-color: #444;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #666;
        }
    </style>
</head>
<body>
    <div class="flicker-container"></div>
    <div class="button-container">
        <button onclick="startFlicker()">Start Flicker</button>
    </div>

    <script>
        const endLocation = { latitude: 51.984878, longitude: 5.888503 };
        const container = document.querySelector(".flicker-container");

        function startFlicker() {
            console.log("Flicker effect started");

            navigator.geolocation.watchPosition((position) => {
                updateFlickerEffect(position, endLocation);
            }, errorCallback, { enableHighAccuracy: true });

            alert("Flicker effect started! Move toward the destination to reduce the flickering intensity.");
        }

        function updateFlickerEffect(position, endLocation) {
            const userCoords = { latitude: position.coords.latitude, longitude: position.coords.longitude };
            const distanceToEnd = calculateDistance(userCoords, endLocation);
            console.log(`Current distance to end: ${distanceToEnd.toFixed(2)} meters`);

            // Adjust flickering frequency and opacity based on distance
            if (distanceToEnd < 2) {
                setFlickerEffect(0, 1); // Near endpoint, no flicker, fully visible
            } else if (distanceToEnd < 6) {
                setFlickerEffect(500, 0.9); // Mild flicker
            } else if (distanceToEnd < 10) {
                setFlickerEffect(300, 0.7); // Moderate flicker
            } else if (distanceToEnd < 20) {
                setFlickerEffect(150, 0.5); // Faster flicker
            } else {
                setFlickerEffect(100, 0.3); // Intense flicker
            }
        }

        function setFlickerEffect(interval, opacity) {
            // Clear previous flicker interval, if any
            if (window.flickerInterval) clearInterval(window.flickerInterval);

            // Set new flickering interval
            window.flickerInterval = setInterval(() => {
                container.style.opacity = container.style.opacity == opacity ? 1 : opacity;
            }, interval);
        }

        function calculateDistance(coords1, coords2) {
            const R = 6371e3; // Earth's radius in meters
            const φ1 = coords1.latitude * Math.PI / 180;
            const φ2 = coords2.latitude * Math.PI / 180;
            const Δφ = (coords2.latitude - coords1.latitude) * Math.PI / 180;
            const Δλ = (coords2.longitude - coords1.longitude) * Math.PI / 180;

            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            const distance = R * c;
            return distance;
        }

        function errorCallback(error) {
            console.error(`ERROR(${error.code}): ${error.message}`);
            alert(`Geolocation error: ${error.message}`);
        }
    </script>
</body>
</html>
